# 1.服务器本地测试
本地测试使用webbench进行测试，测试中发现了以下问题:  
a.文件描述符的限制  
系统默认单个进程最多打开1024个描述符，测试时数量不够，需要自己修改  
修改方法很多https://www.jb51.net/LINUXjishu/160501.html  

b.webbench中需要使用http1.1，否则服务器一直无法正确解析http的GET请求  

c.第二章中的日志模块分为前端和后端，如果前端连续3秒没有新数据进去，则后端刷新前端的数据，需要注意到日志模块没有作为守护进程运行，程序中报错都是用的err_quit，此函数会立即终止进程运行，此时日志模块会跟着一起关掉，所以错误就记录不到了，修改的方法是Err_quit包裹函数，Err_quit中先sleep(5)，再err_quit,这样就不会出现日志数据丢失的问题

d.webbench默认连接80端口，服务器程序如果想运行在80端口下则需要root下运行  

本地测试中由于webbench和服务器程序跑在同一个虚拟机里，会出现系统资源不足的问题  

首先运行服务器程序  
```
[root@promote Debug]# ./simple_webserverv1 80  
端口号为80  
create 0 thread  
create 1 thread  
create 2 thread  
create 3 thread  
工作线程3等待  
事件请求处理线程等待  
工作线程0等待  
工作线程1等待  
工作线程2等待  
```
接着运行webbench，1000个进程连接测试  
```
[admin@promote ~]$ webbench -c 1000 -t 20 -2 http://10.30.83.25/res
Webbench - Simple Web Benchmark 1.5
Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software.

Benchmarking: GET http://10.30.83.25/res (using HTTP/1.1)
1000 clients, running 20 sec.

Speed=148764 pages/min, 168599 bytes/sec.
Requests: 49588 susceed, 0 failed.
```

此时1000个进程，还没问题    
下面改成2000个进程    

```
[admin@promote ~]$ webbench -c 2000 -t 20 -2 http://10.30.83.25/res
Webbench - Simple Web Benchmark 1.5
Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software.

Benchmarking: GET http://10.30.83.25/res (using HTTP/1.1)
2000 clients, running 20 sec.

Speed=143712 pages/min, 162873 bytes/sec.
Requests: 47904 susceed, 0 failed.
```

可以发现此时的Speed值基本上一致，说明服务器的处理速度已经到达极限了，此时增加更多的连接只是会导致任务堆积在工作线程的待处理队列上  

后续再改成3000就报错了，虚拟机资源不足  

# 2.阿里云测试  

a.100进程  
```
[admin@promote Debug]$ webbench -c 100 -t 20 -2 http://139.196.121.203/res
Webbench - Simple Web Benchmark 1.5
Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software.

Benchmarking: GET http://139.196.121.203/res (using HTTP/1.1)
100 clients, running 20 sec.

Speed=4665 pages/min, 5290 bytes/sec.
Requests: 1555 susceed, 0 failed.
```
b.500进程
```
[admin@promote Debug]$ webbench -c 500 -t 20 -2 http://139.196.121.203/res
Webbench - Simple Web Benchmark 1.5
Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software.

Benchmarking: GET http://139.196.121.203/res (using HTTP/1.1)
500 clients, running 20 sec.

Speed=4479 pages/min, 4930 bytes/sec.
Requests: 1450 susceed, 43 failed.
```


